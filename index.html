<!doctype html>
<html>
	<head>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.css"/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/addons/fullscreen/fullscreen.css"/>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/addons/attach/attach.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/addons/fit/fit.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/addons/webLinks/webLinks.js"></script>
		<style>
			@font-face {
				font-family: 'Nutty';
				src: URL('regular.ttf') format('truetype');
				font-weight: normal;
				font-style: normal;
			}

			html, body {
				font-family: 'Nutty';
				margin: 0;
				padding: 0;
			}

			#terminal {
				height: 100vh;
				width: 100vw;
			}
		</style>
	</head>
	<body>
		<div id="terminal"></div>
		<script>
			Terminal.applyAddon(attach)
			Terminal.applyAddon(fit)
			Terminal.applyAddon(webLinks)

			// Mount the terminal.
			var element = document.getElementById('terminal')
			var terminal = new Terminal({
				fontFamily: 'Nutty',
				fontSize: 16
			})

			// Resize pty when terminal resizes.
			terminal.on('resize', ({ cols, rows }) => {
				fetch('/resize', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({
						cols,
						rows
					})
				})
			})

			// Resize the terminal when the window resizes.
			window.addEventListener('resize', () => {
				terminal.fit()
			})

			// Initial fit.
			terminal.open(element)
			terminal.fit()

			// Connect to server.
			var endpoint = `wss://${window.location.host}/terminal`
			var socket = new WebSocket(endpoint)
			socket.onopen = () => terminal.attach(socket);
		</script>
	</body>
</html>
